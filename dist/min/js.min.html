<script>function copyFiles(e,l,o,t){var r=e.shift(),s=r[0],i=r[1];r[2];$("#"+i).html("Copying files <i class='fa fa-spinner fa-spin'></i>").addClass("disabled"),google.script.run.withSuccessHandler(function(){$("#"+i).html("Complete").addClass("bg-success").removeClass("disabled"),e.length>0?copyFiles(e,l,o,t):($("#working").hide("blind"),document.getElementById("complete").innerHTML="Successfully copied folder to your <a href='https://drive.google.com/drive/folders/"+l+"' target='_blank'>Google Drive</a>.",document.getElementById("complete").style.display="block",document.getElementById("please-review").style.display="block")}).withFailureHandler(function(o){$("#errors").append("<div class='alert alert-danger' role='alert'><b>Error:</b> There was an error copying files to folder '"+i+"'.<br /><b>Error message:</b> "+o+".</div>"),e.length>0?copyFiles(e):($("#working").hide("blind"),document.getElementById("complete").innerHTML="Successfully copied folder to your <a href='https://drive.google.com/drive/folders/"+l+"' target='_blank'>Google Drive</a>.",document.getElementById("complete").style.display="block",document.getElementById("please-review").style.display="block")}).copyFiles(s,i,o,t)}
function createFolders(t,e,r,a){google.script.run.withSuccessHandler(function(t){var e=t[0],r=t[1],a=t[2],s=t[3];for($("#working").html("Folders structure copied successfully.<br />Copying files..."),statusTable="<table class='table table-striped'>",statusTable+="<tr><th>Folder path</th><th>Status</th></tr>",i=0;i<r.length;i++)statusTable+="<tr>",statusTable+="<td>"+r[i][2]+"</td>",statusTable+="<td id='"+r[i][1]+"'><i>Waiting...</i></td>",statusTable+="</tr>";statusTable+="</table>",$("#status-table").html(statusTable).show("blind"),copyFiles(r,e,a,s)}).withFailureHandler(function(t){var e="<div class='alert alert-danger' role='alert'><b>Error:</b> There was an error creating folder structure.<br />";e+="<b>Error message:</b> "+t+".<br>",e+="Please try again. Make sure you have correct permissions to copy this folder, and please input the entire sharing URL, not just the folder ID</div>",$("#errors").append(e),$("#working").hide("blind")}).createFolders(t,e,"None",r,a,[])}
function getValues(){var e=[],r=thisForm.folderId.value,a=r.search("id="),l=r.search("folders");a>0?r=r.slice(a+3):l>0&&(r=r.slice(l+8));var i=r.indexOf("&");i>0&&(r=r.slice(0,i)),thisForm.folderId.value=r,google.script.run.withSuccessHandler(function(r){var a=r[0],l=(r[1],r[2]),i=r[3];createFolders(a,l,e,i)}).withFailureHandler(function(e){$("#errors").append("<div class='alert alert-danger' role='alert'><b>Error:</b> There was an error getting the folder information:<br />"+e+"</div>")}).getValues(thisForm)}
$(document).ready(function(){function i(){$("#dialog-message").dialog({modal:!0,buttons:{Ok:function(){$(this).dialog("close")}}})}$("#working").hide(),$("#notes").hide(),$("#status").hide(),$("#complete").hide(),$("#please-review").hide(),$("#dialog-message").hide(),$("#status-table").hide(),$("#copyFolderButton").click(function(){$("#description").hide("blind"),$("#working").show("blind"),getValues()}),$("#explain-permissions").click(i),$("#permissions").click(function(){$(this).is(":checked")&&i()})});</script>