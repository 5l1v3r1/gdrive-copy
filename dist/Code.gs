function doGet(e){var i=HtmlService.createTemplateFromFile("Index");return i.thisForm=e.parameter.thisForm,i.evaluate().setTitle("Copy a Google Drive folder").setSandboxMode(HtmlService.SandboxMode.IFRAME)}function getValues(e){var i=e.newFolder,t=e.permissions,r=e.copyLocationOptions,o=[];return o.push(i),o.push(t),o.push(r),o}function createFolders(e,t,r,o,a,d,g){var l,p=DriveApp.getFolderById(e),n=p.getFolders(),s=[],h=[];l="root"==g?DriveApp.createFolder(t):"same"==g?DriveApp.getFolderById(r).createFolder(t):DriveApp.getFolderById(r).createFolder(t);var u=l.getId();if(a){d.push(Session.getActiveUser().getEmail());var f=p.getEditors();f.push(p.getOwner());var m=p.getViewers();for(i=0;i<f.length;i++)-1==d.indexOf(f[i].getEmail())&&(l.addEditor(f[i]),d.push(f[i].getEmail()));for(i=0;i<m.length;i++)-1==d.indexOf(m[i].getEmail())&&(l.addViewer(m[i]),d.push(f[i].getEmail()))}var v=getFullPath("",u);for(v+=t,Logger.log("finished top folder");n.hasNext();){Logger.log("first child folder");var c=n.next(),F=c.getId(),E=c.getName();createFolders(F,E,l.getId(),o,a,d)}return s.push(e),s.push(u),s.push(v),o.push(s),h.push(u),h.push(o),h.push(a),h.push(d),h}function copyFiles(e,t,r,o){for(var a=DriveApp.getFolderById(e),d=DriveApp.getFolderById(t),g=(d.getName(),a.getFiles());g.hasNext();){var l=g.next(),p=l.getName(),n=l.makeCopy(p,d);if(r){var s=l.getEditors();s.push(l.getOwner());var h=l.getViewers();if("application/vnd.google-apps.document"==l.getMimeType()){var u=DocumentApp.openById(n.getId());for(i=0;i<s.length;i++)-1==o.indexOf(s[i].getEmail())&&u.addEditor(s[i]);for(i=0;i<h.length;i++)-1==o.indexOf(h[i].getEmail())&&u.addViewer(h[i])}else if("application/vnd.google-apps.spreadsheet"==l.getMimeType()){var f=SpreadsheetApp.openById(n.getId());for(i=0;i<s.length;i++)-1==o.indexOf(s[i].getEmail())&&f.addEditor(s[i]);for(i=0;i<h.length;i++)-1==o.indexOf(h[i].getEmail())&&f.addViewer(h[i])}else{for(i=0;i<s.length;i++)-1==o.indexOf(s[i].getEmail())&&n.addEditor(s[i]);for(i=0;i<h.length;i++)-1==o.indexOf(h[i].getEmail())&&n.addViewer(h[i])}}}}function getFullPath(e,i){var t=DriveApp.getFolderById(i).getParents(),r=t.next();return"My Drive"!=r.getName()&&(e=r.getName()+" > "+e,r.getParents().hasNext()&&(e=getFullPath(e,r.getId()))),e}function getOAuthToken(){return ScriptApp.getOAuthToken()}