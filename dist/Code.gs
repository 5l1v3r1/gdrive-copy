function doGet(e){var i=HtmlService.createTemplateFromFile("Index");return i.thisForm=e.parameter.thisForm,i.evaluate().setTitle("Copy a Google Drive folder").setSandboxMode(HtmlService.SandboxMode.IFRAME)}function getValues(e){var i=e.folderId,t=DriveApp.getFolderById(i).getName(),r=e.newFolder,d=e.permissions,a=[];return a.push(i),a.push(t),a.push(r),a.push(d),a}function createFolders(e,t,r,d,a,o){var g,l=DriveApp.getFolderById(e),p=l.getFolders(),n=[],s=[];g="None"==r?DriveApp.createFolder(t):DriveApp.getFolderById(r).createFolder(t);var h=g.getId();if(a){o.push(Session.getActiveUser().getEmail());var f=l.getEditors();f.push(l.getOwner());var u=l.getViewers();for(i=0;i<f.length;i++)-1==o.indexOf(f[i].getEmail())&&(g.addEditor(f[i]),o.push(f[i].getEmail()));for(i=0;i<u.length;i++)-1==o.indexOf(u[i].getEmail())&&(g.addViewer(u[i]),o.push(f[i].getEmail()))}var m=getFullPath("",h);for(m+=t,Logger.log("finished top folder");p.hasNext();){Logger.log("first child folder");var v=p.next(),F=v.getId(),c=v.getName();createFolders(F,c,g.getId(),d,a,o)}return n.push(e),n.push(h),n.push(m),d.push(n),s.push(h),s.push(d),s.push(a),s.push(o),s}function copyFiles(e,t,r,d){for(var a=DriveApp.getFolderById(e),o=DriveApp.getFolderById(t),g=(o.getName(),a.getFiles());g.hasNext();){var l=g.next(),p=l.getName(),n=l.makeCopy(p,o);if(r){var s=l.getEditors();s.push(l.getOwner());var h=l.getViewers();if("application/vnd.google-apps.document"==l.getMimeType()){var f=DocumentApp.openById(n.getId());for(i=0;i<s.length;i++)-1==d.indexOf(s[i].getEmail())&&f.addEditor(s[i]);for(i=0;i<h.length;i++)-1==d.indexOf(h[i].getEmail())&&f.addViewer(h[i])}else if("application/vnd.google-apps.spreadsheet"==l.getMimeType()){var u=SpreadsheetApp.openById(n.getId());for(i=0;i<s.length;i++)-1==d.indexOf(s[i].getEmail())&&u.addEditor(s[i]);for(i=0;i<h.length;i++)-1==d.indexOf(h[i].getEmail())&&u.addViewer(h[i])}else{for(i=0;i<s.length;i++)-1==d.indexOf(s[i].getEmail())&&n.addEditor(s[i]);for(i=0;i<h.length;i++)-1==d.indexOf(h[i].getEmail())&&n.addViewer(h[i])}}}}function getFullPath(e,i){var t=DriveApp.getFolderById(i).getParents(),r=t.next();return"My Drive"!=r.getName()&&(e=r.getName()+" > "+e,r.getParents().hasNext()&&(e=getFullPath(e,r.getId()))),e}