<script>function copyFiles(e,t,n,o){var l=e.shift(),d=l[0],c=l[1],i=l[2];document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+'<br />Copying files to "'+i+'"...',google.script.run.withSuccessHandler(function(){document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+" <b>Done</b>",e.length>0?copyFiles(e,t,n,o):(document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+"<br />Folder copy is complete.",document.getElementById("working").style.display="none",document.getElementById("complete").innerHTML="Successfully copied folder to your <a href='https://drive.google.com/drive/folders/"+t+"' target='_blank'>Google Drive</a>.",document.getElementById("complete").style.display="block",document.getElementById("please-review").style.display="block")}).withFailureHandler(function(n){document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+"<br />failure copying files: "+n,e.length>0?copyFiles(e):(document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+"<br />Folder copy is complete.",document.getElementById("working").style.display="none",document.getElementById("complete").innerHTML="Successfully copied folder to your <a href='https://drive.google.com/open?id="+t+"'>Google Drive</a>.",document.getElementById("complete").style.display="block",document.getElementById("please-review").style.display="block")}).copyFiles(d,c,n,o)}
function createFolders(e,t,n,s){google.script.run.withSuccessHandler(function(e){var t=e[0],n=e[1],s=e[2],a=e[3];for(document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+"<b>Done</b>",document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+"<br />Beginning file copying (this can take a while)",statusTable="<table class='table table-striped'>",statusTable+="<tr><th>Folder path</th><th>Status</th></tr>",i=0;i<n.length;i++)statusTable+="<tr>",statusTable+="<td>"+n[i][2]+"</td>",statusTable+="<td id='"+n[i][1]+"'><span class='waiting'>Waiting...</span></td>",statusTable+="</tr>";statusTable+="</table>",$("#status-table").html(statusTable).show("blind"),copyFiles(n,t,s,a)}).withFailureHandler(function(e){document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+"<br />failed to create folder: "+e,document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+"<br />Please try again. Make sure you have correct permissions to copy this folder, and please input the entire sharing URL, not just the folder ID",document.getElementById("working").style.display="none"}).createFolders(e,t,"None",n,s,[])}
function getValues(){var e=[],n=thisForm.folderId.value,t=n.search("id="),r=n.search("folders");t>0?n=n.slice(t+3):r>0&&(n=n.slice(r+8));var o=n.indexOf("&");o>0&&(n=n.slice(0,o)),thisForm.folderId.value=n,google.script.run.withSuccessHandler(function(n){var t=n[0],r=n[1],o=n[2],i=n[3];document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+'<br />Initializing copy from "'+r+'" to "'+o+'".',document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+"<br />Recreating folder structure ... ",createFolders(t,o,e,i)}).withFailureHandler(function(e){document.getElementById("notes").innerHTML=document.getElementById("notes").innerHTML+"<br />failure<br />"+e}).getValues(thisForm)}
$(document).ready(function(){function i(){$("#dialog-message").dialog({modal:!0,buttons:{Ok:function(){$(this).dialog("close")}}})}$("#working").hide(),$("#notes").hide(),$("#status").hide(),$("#complete").hide(),$("#please-review").hide(),$("#dialog-message").hide(),$("#status-table").hide(),$("#copyFolderButton").click(function(){$("#description").hide("blind"),$("#working").show("blind"),$("#notes").show("blind"),$("#status").show("blind"),getValues()}),$("#explain-permissions").click(i),$("#permissions").click(function(){$(this).is(":checked")&&i()})});</script>